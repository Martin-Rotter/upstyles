\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{updiplomex}[2012/09/09 UP Diploma Style]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% packages and arguments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{kvoptions}
%\usepackage{a4}
\usepackage[paper=a4paper,driver=pdftex,left=4cm,width=1.05\textwidth]{geometry}
\usepackage{booktabs}
\usepackage{makeidx}
\usepackage{multicol}
\usepackage[unicode]{hyperref}
\usepackage{ifpdf}
\usepackage{ifthen}
\usepackage{amsmath}
\usepackage{amsbsy}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{euscript}
\usepackage[open,atend]{bookmark}
\usepackage{relsize}
\usepackage{inconsolata}
\usepackage[usenames,dvipsnames]{xcolor}

\SetupKeyvalOptions {
	family=up,
	prefix=up@
}

\DeclareBoolOption{iwona}
\DeclareBoolOption{final}
\DeclareBoolOption{blacklogo}
\DeclareBoolOption{master}
\DeclareBoolOption{joinlists}
\DeclareBoolOption{figures}
\DeclareBoolOption{tables}
\DeclareBoolOption{listings}
\DeclareStringOption[czech]{language}[czech]
\DeclareStringOption[bibliography.bib]{bibfile}[bibliography.bib]
\DeclareStringOption[utf8]{bibencoding}[utf8]
\DeclareStringOption[iso-authoryear]{bibcitestyle}[iso-authoryear]
\DeclareStringOption[Anotace]{titleanot}[Anotace]
\DeclareStringOption[Seznam zdrojov\'ych k\'od\r{u}]{titlelistings}[Seznam zdrojových k\'od\r{u}]
\DeclareStringOption[Zdrojov\'y k\'od]{namelistings}[Zdrojov\'y k\'od]
\DeclareStringOption[Z\'av\v er]{titleconclusioncz}[Z\'av\v er]
\DeclareStringOption[Conclusions]{titleconclusionen}[Conclusions]
\DeclareStringOption[Tituln\'i strana]{titlebookmarktitlepage}[Tituln\'i strana]
\DeclareStringOption[utf8]{encoding}[utf8]

\ProcessKeyvalOptions*

\usepackage[\up@encoding]{inputenc}
\usepackage[english,\up@language]{babel}
\usepackage[autostyle=try]{csquotes}
\usepackage[savemem]{listings}
\usepackage[backend=biber,babel=other,sortlocale=cs_CZ,bibencoding=\up@bibencoding,style=\up@bibcitestyle]{biblatex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% iwona fonts package
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\boolean{up@iwona}} {
\usepackage{iwona}
} {
\relax
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% graphicx package
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\boolean{pdf}} {
\usepackage[pdftex]{graphicx}
} {
\usepackage{graphicx}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% czech quotes for csquotes
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\DeclareQuoteStyle{czech}
  {\quotedblbase}
  {\textquotedblleft}
  {\textquoteleft}
  {\textquoteright}
\setquotestyle{czech}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% appendix
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\upappendix{
\clearpage
%\addtocontents{toc}{\vspace*{10px}}
\appendix
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% index
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\let\orgtheindex\theindex
\let\orgendtheindex\endtheindex
\def\theindex{
\def\twocolumn{\begin{multicols}{2}}
\def\onecolumn{}
\clearpage
\orgtheindex
}
\def\endtheindex{
\end{multicols}
\orgendtheindex
}

\makeindex
\def\upprintindex{
\clearpage
\phantomsection
\addcontentsline{toc}{section}{Rejstřík}
\printindex
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% colors
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{halfgray}{gray}{0.55}
\definecolor{webgreen}{rgb}{0,.5,0}
\definecolor{webbrown}{rgb}{.6,0,0}
\definecolor{lightergray}{gray}{0.98}
\definecolor{ultragreen}{RGB}{40,180,10}
\definecolor{darkgray}{RGB}{100,100,100}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% fancy macros and misc opts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% macros
\newcommand{\csharp}{C\kern-.03em\raise.38ex\hbox{\scriptsize{\#}}\ }
\newcommand{\cpp}{C\kern-.11em\raise.38ex\hbox{\scriptsize{++}}\ }
\newcommand{\keyword}[1]{{\ttfamily\color{darkgray}{#1}}}
\newcommand{\buno}{bez \'ujmy na obecnosti}
\newcommand{\Buno}{Bez \'ujmy na obecnosti}

%% settings
\renewcommand\labelitemi{\color{halfgray}$\bullet$} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% bibliography
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\nocite{*}
\bibliography{\up@bibfile}

\def\upprintbibliography{
\clearpage
\phantomsection
\addcontentsline{toc}{section}{\bibname}
\printbibliography
}

\setcounter{biburlnumpenalty}{9000}
\setcounter{biburlucpenalty}{9000}
\setcounter{biburllcpenalty}{9000}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% listings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\renewcommand{\lstlistlistingname}{\up@titlelistings}
\renewcommand{\lstlistingname}{\up@namelistings}

\lstset{language=[GNU]C++,
keywordstyle=\color{RoyalBlue},
%basicstyle=\normalfont\sffamily,
commentstyle=\color{ultragreen},
%identifierstyle=\color{Gray},
stringstyle=\color{Red},
numbers=none,
numberstyle=\scriptsize,
stepnumber=5,
numbersep=8pt,
showstringspaces=false,
breaklines=true,
frameround=ftff,
frame=lines,
backgroundcolor=\color{lightergray},
}

\lstset{flexiblecolumns=true}
\lstset{moredelim={[is][\small\normalfont\itshape]{/*}{*/}}}
\lstset{basicstyle=\small\normalfont\ttfamily}
\lstset{flexiblecolumns=false}
\lstset{numberbychapter=true}
\lstset{moredelim={[is][\small\ttfamily]{!?}{?!}}} 
\lstset{escapeinside={£*}{*£}}
\lstset{firstnumber=last}
\lstset{moredelim={[is][\small\ttfamily]{!?}{?!}}}

\lstset{numbers=left,
    numberstyle=\scriptsize\ttfamily,
    stepnumber=1,
    numbersep=8pt
}

\lstnewenvironment{upcode}[3]
{\lstset{language=#3,firstnumber=1,caption={#1},label={#2},aboveskip=15px,belowskip=20px}}
{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% logos
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\boolean{up@blacklogo}} {
\def\logoname{graphics/uplogo-black}
} {
\def\logoname{graphics/uplogo-white}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% conclusions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newenvironment{upconclusions}[1][czech]{
\clearpage
\bgroup
\ifthenelse{\equal{#1}{czech}} {
\phantomsection
\addcontentsline{toc}{section}{\up@titleconclusioncz}
\section*{\up@titleconclusioncz}
} {
\phantomsection
\addcontentsline{toc}{section}{\up@titleconclusionen}
\section*{\up@titleconclusionen}
}
} {
\egroup}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% titlepage heading
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\boolean{up@master}} {
\def\@upthesis{DIPLOMOV\'A PR\'ACE}
} {
\def\@upthesis{BAKAL\'A\v RSK\'A PR\'ACE}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% titlepage implementation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\uptitle#1{\gdef\@uptitle{#1}}
\def\upsubtitle#1{\gdef\@upsubtitle{#1}}
\def\upyear#1{\gdef\@upyear{#1}}
\def\upauthor#1{\gdef\@upauthor{#1}}
\def\upleader#1{\gdef\@upleader{#1}}
\def\upclass#1{\gdef\@upclass{#1}}

\def\upmaketitle{
\hypertarget{up:thesis}{}
\bookmark[dest=up:thesis]{\@uptitle \ (\@upthesis)}
\setcounter{page}{1}
\begin{titlepage}
\hypertarget{up:title}{}
\bookmark[
 rellevel=1,
 keeplevel,
 dest=up:title
]{\up@titlebookmarktitlepage}
\begin{center}
{\large P\v R\'IRODOV\v EDECK\'A FAKULTA UNIVERZITY PALACK\'EHO \par
        KATEDRA INFORMATIKY \par}
\vfill
{\LARGE\bfseries{\@upthesis} \\}
\vfill
{\Large \@uptitle \\[1em]\@upsubtitle}
\vfill
\centering\includegraphics[width=2.5cm]{\logoname}
\vfill
{\noindent
\begin{tabular}{ll}
Vedoucí práce: \\
{\bfseries\@upleader} \\
Rok odevzdání: \@upyear
\end{tabular}
\hfill
\begin{tabular}{ll}
Diplomant: \\
{\bfseries\@upauthor} \\
\@upclass
\end{tabular}}
%{\noindent \Large \@upyear \hfill \@upauthor}
\end{center}
\newpage
\end{titlepage}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% hyperref
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\boolean{up@final}} {
\hypersetup {
colorlinks=false
}
} {
\hypersetup {
colorlinks=true
}
}

\hypersetup {
    linktocpage=true, pdfstartpage=1, 
    pdfstartview=FitV, breaklinks=true, pdfpagemode=UseNone, 
    pageanchor=true,
    plainpages=false, bookmarksnumbered,
    hypertexnames=true, pdfhighlight=/O,
    urlcolor=webbrown, linkcolor=RoyalBlue, 
    citecolor=webgreen,
}

\newcommand{\mail}[1]{\href{mailto:#1}{\texttt{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% toc implementation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\uptableofcontents{
\hypertarget{up:toc}{}
\bookmark[
 rellevel=1,
 keeplevel,
 dest=up:toc
]{\contentsname}
\tableofcontents
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% anot+thanks implementation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\upthanks#1{\gdef\@upthanks{#1}}
\def\upanot#1{\gdef\@upanot{#1}}

\def\upthanksanot{
\thispagestyle{empty}
\null\vfill
\hypertarget{up:anotation}{}
\bookmark[
 rellevel=1,
 keeplevel,
 dest=up:anotation
]{\up@titleanot}
\begin{center}
\textbf{\up@titleanot}
\end{center}
\bigskip
\emph{\@upanot}
\vfill\null
\clearpage
\thispagestyle{empty}
\vspace*{\fill}
\noindent\@upthanks
\bigskip
\clearpage
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% lists implementation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\upprintlists{
\ifthenelse{\boolean{up@figures}} {
\listoffigures
\ifthenelse{\boolean{up@joinlists}} {
\relax
} {
\clearpage
}
} {
\relax
}
\ifthenelse{\boolean{up@tables}} {
\listoftables
\ifthenelse{\boolean{up@joinlists}} {
\relax
} {
\clearpage
}
} {
\relax
}
\ifthenelse{\boolean{up@listings}} {
\lstlistoflistings
\ifthenelse{\boolean{up@joinlists}} {
\relax
} {
\clearpage
}
} {
\relax
}
\clearpage
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% toc+lists implementation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\uptocandlists{
\uptableofcontents
\ifthenelse{\boolean{up@joinlists}} {
\relax
} {
\clearpage
}
\upprintlists
}

\endinput
