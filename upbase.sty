\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{upbase}[2012/09/09 UP Base Style]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Načítání balíků.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{booktabs}
\RequirePackage{makeidx}
\RequirePackage{multicol}
\RequirePackage[unicode]{hyperref}
\RequirePackage{ifpdf}
\RequirePackage{ifthen}
\RequirePackage{amsmath}
\RequirePackage{amsbsy}
\RequirePackage{amssymb}
\RequirePackage{amsthm}
\RequirePackage{euscript}
\RequirePackage[open,atend]{bookmark}
\RequirePackage[usenames,dvipsnames,table]{xcolor}
\RequirePackage{appendix}
\RequirePackage{chngcntr}
\RequirePackage{ragged2e}
\RequirePackage{tabularx}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Deklarace parametrů.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\SetupKeyvalOptions{
  family=upb,
  prefix=upb@
}

\DeclareStringOption[false]{iwona}[false]
\DeclareStringOption[false]{printversion}[false]
\DeclareStringOption[false]{blacklogo}[false]
\DeclareStringOption[true]{joinlists}[true]
\DeclareStringOption[false]{figures}[false]
\DeclareStringOption[false]{tables}[false]
\DeclareStringOption[false]{sourcecodes}[false]
\DeclareStringOption[false]{theorems}[false]
\DeclareStringOption[false]{glossaries}[false]
\DeclareStringOption[czech]{language}[czech]
\DeclareStringOption[utf8]{bibencoding}[utf8]
\DeclareStringOption[iso-numeric]{bibstyle}[iso-numeric]
\DeclareStringOption[utf8]{encoding}[utf8]
\DeclareStringOption[false]{index}[false]

%% Varujeme uživatele před neznámými argumenty.
\DeclareDefaultOption{\PackageWarningNoLine{upbase}{[upbase] Option '\CurrentOption' was not recognized}}

\ProcessKeyvalOptions*

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Načítání balíků, které závisejí na parametrech.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage[\upb@encoding]{inputenc}
\RequirePackage[czech,english,\upb@language]{babel}
\RequirePackage[autostyle=try]{csquotes}
\RequirePackage[savemem]{listings}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Nastavení dynamických textů.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Čestina.
\ifthenelse{\equal{\upb@language}{czech}}{

  % Načtení BibLaTeXu.
  \RequirePackage[
    natbib=true,
    backend=bibtex,
    sortcites=true,
    style=\upb@bibstyle,
    babel=other,
    sortlocale=cs_CZ,
    bibencoding=\upb@bibencoding
  ]{biblatex}

	\newcommand{\uptexttitle}{Tituln\'{i} strana}
	\newcommand{\uptexttitletop}{P\v R\'IRODOV\v EDECK\'A FAKULTA UNIVERZITY PALACK\'EHO}
	\newcommand{\uptextdept}{KATEDRA INFORMATIKY}
	\newcommand{\uptextindex}{Rejst\v{r}\'{i}k}
	\newcommand{\buno}{bez \'{u}jmy na obecnosti}
	\newcommand{\Buno}{Bez \'{u}jmy na obecnosti}
	\renewcommand{\lstlistlistingname}{Seznam zdrojov\'ych k\'od\r{u}}
	\renewcommand{\lstlistingname}{Zdrojov\'y k\'od}
	\newcommand{\listtheoremname}{Seznam v\v et}

	\newcommand{\uptextdefinition}{Definice}
	\newcommand{\uptextlemma}{Lemma}
	\newcommand{\uptextconsequence}{D\r{u}sledek}
	\newcommand{\uptextremark}{Pozn\'{a}mka}
	\newcommand{\uptexttheorem}{V\v{e}ta}
	\newcommand{\uptextproof}{D\r{u}kaz}
	\newcommand{\uptextexample}{P\v{r}\'{i}klad}

	\ifthenelse{\equal{\upb@glossaries}{true}}{
		\RequirePackage[acronym,nonumberlist,sanitize=none]{glossaries}
		\renewcommand{\acronymname}{Seznam zkratek}
	}{
	\relax
	}

}{
	\relax
}

% Angličtina.
\ifthenelse{\equal{\upb@language}{english}}{

  % Načtení BibLaTeXu.
  \RequirePackage[
    natbib,
    backend=bibtex,
    sortcites=true,
    style=\upb@bibstyle,
    babel=other,
    sortlocale=en_GB,
    bibencoding=\upb@bibencoding,
    spacecolon=false
  ]{biblatex}

	\newcommand{\uptexttitle}{Title page}
	\newcommand{\uptexttitletop}{FACULTY OF SCIENCE, PALACK\'{Y} UNIVERSITY}
	\newcommand{\uptextdept}{DEPARTMENT OF COMPUTER SCIENCE}
	\newcommand{\uptextindex}{Index}
	\newcommand{\buno}{without loss of generality}
	\newcommand{\Buno}{Without loss of generality}
	\renewcommand{\lstlistlistingname}{List of source codes}
	\renewcommand{\lstlistingname}{Source code}
	\newcommand{\listtheoremname}{List of theorems}

	\newcommand{\uptextdefinition}{Definition}
	\newcommand{\uptextlemma}{Lemma}
	\newcommand{\uptextconsequence}{Corollary}
	\newcommand{\uptextremark}{Remark}
	\newcommand{\uptexttheorem}{Theorem}
	\newcommand{\uptextproof}{Proof}
	\newcommand{\uptextexample}{Example}

	\ifthenelse{\equal{\upb@glossaries}{true}}{
		\RequirePackage[acronym,nonumberlist,sanitize=none]{glossaries}
		\renewcommand{\acronymname}{List of abbreviations}
	}{
	\relax
	}

}{
	\relax
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Načtení balíku iwona pro nepatkové písmo.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\equal{\upb@iwona}{true}}{
	\RequirePackage[light,math]{iwona}
}{
	\relax
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Načtení balíku graphicx pro sazbu obrázků.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\boolean{pdf}}{
	\RequirePackage[pdftex]{graphicx}
}{
	\RequirePackage{graphicx}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Zkratky a seznam zkratek.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\equal{\upb@glossaries}{true}}{
	% Zapnutí generování zkratek.
	\makeglossaries

	% Zkratky tučně a bez interpunkce za zkratkou.
	\renewcommand{\glsnamefont}[1]{\textbf{#1}}
	\renewcommand{\glspostdescription}{}

	% Záloha starého seznamu zkratek.
	\let\orgprintglossary=\printglossary

	% Definice nového seznamu zkratek.
	% Přidává záznam do obsahu.
	\renewcommand{\printglossary}{
		\clearpage
		\phantomsection
		\addcontentsline{toc}{section}{\acronymname}
		\orgprintglossary[type=\acronymtype]
	}
}{
	\relax
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% České závorky pro balík csquotes.
%% použití: \enquote{citoslovce}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\DeclareQuoteStyle{czech}
	{\quotedblbase}
	{\textquotedblleft}
	{\textquoteleft}
	{\textquoteright}

% Redeklarace makra \uv, aby používalo csquotes.
% Makro \uv bude tisknout typ závorek v závislosti na jazyku prostředí.
\renewcommand{\uv}[1]{\enquote{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Deklarace nových sloupců pro tabulky.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Sloupce s uživatelsky stanovenou šířkou a zarovnáním textu na danou stranu.
%% Použití: \begin{tabular}{| c | L{3cm} | C{3cm} | R{3cm} |}
\newcolumntype{L}[1]{>{\RaggedRight\hspace{0pt}}p{#1}}
\newcolumntype{R}[1]{>{\RaggedLeft\hspace{0pt}}p{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Rejstřík
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\equal{\upb@index}{true}}{
\newcounter{indexno}
\stepcounter{indexno}
  
% Zapne rejstříkování.
\makeindex

% Zálohy starých maker.
\let\orgindex=\index
\let\orgtheindex=\theindex
\let\orgendtheindex=\endtheindex
\let\orgprintindex=\printindex

\newcommand{\indexcolumns}{2}
\newcommand{\indexemph}[1]{{\itshape #1}}

% Předefinování prostředí pro sazbu rejstříku.
\renewenvironment{theindex}{
  \newpage
  \bgroup
  \section*{\uptextindex\@mkboth{\uptextindex}{\uptextindex}}
  \addcontentsline{toc}{section}{\uptextindex}
  \def\item{\par}
  \def\subitem{\par---\kern1ex}
  \def\subsubitem{\par---\kern1ex---\kern1ex}
  \def\indexspace{\smallskip}
  \setlength{\parindent}{-2em}
  \setlength{\leftskip}{2em}
  \begin{multicols*}{\indexcolumns}
  } {
\end{multicols*}
\egroup
}

% Tiskne rejstřík s vynechanou stranou.
\renewcommand{\printindex}{
  \clearpage
  \phantomsection
  \orgprintindex
}

\renewcommand{\index}[1]{\stepcounter{indexno}\hyperlink{\arabic{indexno}ind.ind}{#1}\orgindex{#1\protect\hypertarget{\arabic{indexno}ind.ind}{}}}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Dodatečné barvy.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{halfgray}{gray}{0.55}
\definecolor{webgreen}{rgb}{0,.5,0}
\definecolor{webbrown}{rgb}{.6,0,0}
\definecolor{lightergray}{gray}{0.99}
\definecolor{ultragreen}{rgb}{40,180,10}
\definecolor{darkgray}{rgb}{60,60,60}
\definecolor{darkblue}{rgb}{0.2, 0.3, 0.6}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Drobná nastavení
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Makra.
\newcommand{\csharp}{C\kern-.03em\raise.38ex\hbox{\scriptsize{\#}}}
\newcommand{\cpp}{C\kern-.05em\raise.38ex\hbox{\scriptsize{++}}}
\newcommand{\keyword}[1]{{\ttfamily\color{darkgray}{#1}}}

%% Přílohy.
\let\orgappendix=\appendix

\renewcommand{\appendix}{
	\clearpage
	\orgappendix
}

%% Nastaví PDF záložky na kořen.
\newcommand{\upendofmainmatter}{
	\bookmarksetup{startatroot}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Bibliografie
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Záloha bibliografie.
\let\orgprintbibliography=\printbibliography

% Tisk bibliografie + záznam v obsahu.
\renewcommand{\printbibliography}{
	\clearpage
	\phantomsection
	\addcontentsline{toc}{section}{\bibname}
	\orgprintbibliography
}

% Makra, která umlčí překladač TeX v případě "drobných" přetečení textu, která
% se v bibliografii dějí běžně.
\setcounter{biburlnumpenalty}{9000}
\setcounter{biburlucpenalty}{9000}
\setcounter{biburllcpenalty}{9000}

\renewenvironment{thebibliography}[1]{
	\section*{\refname
    \@mkboth{\MakeUppercase\refname}{\MakeUppercase\refname}}
	\addcontentsline{toc}{section}{\refname}
	\list{\@biblabel{\@arabic\c@enumiv}}
	{\settowidth\labelwidth{\@biblabel{#1}}
    \leftmargin\labelwidth
    \advance\leftmargin\labelsep
    \@openbib@code
    \usecounter{enumiv}
    \let\p@enumiv\@empty
    \renewcommand\theenumiv{\@arabic\c@enumiv}}
	\sloppy
	\clubpenalty4000
	\@clubpenalty \clubpenalty
	\widowpenalty4000
	\sfcode`\.\@m
} {
	\def\@noitemerr
	{\@latex@warning{Empty `thebibliography' environment}}
  	\endlist
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Makra pro \subsubsubsection.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setcounter{tocdepth}{5}
\setcounter{secnumdepth}{5}
\newcommand{\subsubsubsection}{\@startsection{paragraph}{4}{0ex}
   {-3.25ex plus -1ex minus -0.2ex}
   {1.5ex plus 0.2ex}%
   {\normalfont\normalsize\bfseries}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Implementace obsahu.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Záloha starého obsahu.
\let\orgtableofcontents=\tableofcontents

% Přidán záznam do PDF záložek.
\renewcommand{\tableofcontents}{
	\cleardoublepage
	\hypertarget{up:toc}{}
	\bookmark[
		rellevel=1,
		keeplevel,
		dest=up:toc
	]{\contentsname}
	\orgtableofcontents
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Zdrojové kódy.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Typewriter font, který umí i bold.
\renewcommand{\ttdefault}{pcr}

% Modifikace originálních maker, tak aby respektovala jiný obsah.
\lst@UserCommand\lstlistoflistings{\bgroup
    \let\contentsname\lstlistlistingname
    \let\lst@temp\@starttoc \def\@starttoc##1{\lst@temp{lol}}
    \orgtableofcontents \egroup}

% Definice základního stylu sazby zdroj. kódů.
\lstdefinestyle{upbasestyle}{
	breaklines=true,
	flexiblecolumns=true,
	basicstyle=\footnotesize\ttfamily,
	keywordstyle=\bfseries,
	commentstyle=\color{gray},
	stringstyle=\color{black},
	numberbychapter=false,
	escapeinside={£*}{*£},
	firstnumber=1,
	numbers=left,
	captionpos=b,
	numbersep=10pt,
	inputencoding=\upb@encoding,
	numberstyle=\scriptsize\ttfamily,
	stepnumber=1,
	showstringspaces=false,
	tabsize=2,
	extendedchars=true,
	literate=
		{á}{{\'a}}1
		{í}{{\'i}}1
		{é}{{\'e}}1
		{ý}{{\'y}}1
    {ú}{{\'u}}1
    {ó}{{\'o}}1
    {ě}{{\v{e}}}1
    {š}{{\v{s}}}1
    {č}{{\v{c}}}1
    {ř}{{\v{r}}}1
    {ž}{{\v{z}}}1
    {ď}{{\v{d}}}1
    {ť}{{\v{t}}}1
    {ň}{{\v{n}}}1                
    {ů}{{\r{u}}}1
    {Á}{{\'A}}1
    {Í}{{\'I}}1
    {É}{{\'E}}1
    {Ý}{{\'Y}}1
    {Ú}{{\'U}}1
    {Ó}{{\'O}}1
    {Ě}{{\v{E}}}1
    {Š}{{\v{S}}}1
    {Č}{{\v{C}}}1
    {Ř}{{\v{R}}}1
    {Ž}{{\v{Z}}}1
    {Ď}{{\v{D}}}1
    {Ť}{{\v{T}}}1
    {Ň}{{\v{N}}}1                
    {Ů}{{\r{U}}}1    
}

% Definice dodatečných jazyků.
\lstdefinelanguage{TutorialD}{morekeywords={tuple,matching,insert,divide,by,per,tclose,from,summarize,count,all,but,as,base,rename,prefix,extend,add,compose,union,minus,intersect,update,writeln,init,type,possrep,constraint,and,or,relation,where,base,drop},
	sensitive=false,
	morecomment=[s][commentstyle]{/*}{*/},
	morestring=[b][stringstyle]{"},
}

\lstdefinelanguage{text}{
	morekeywords={},
	sensitive=false,
}

\lstdefinelanguage{csharp}{
	morekeywords={int,ref,static,fixed,unsafe,public,private,protected,return,for,if,void},
	sensitive=false,
	morecomment=[s][commentstyle]{/*}{*/},
	morecomment=[l][commentstyle]{//},
	morestring=[b][stringstyle]{"},
}

\lstdefinelanguage{cpp}{
  morekeywords={int,enum,struct,static,bool,return,for,if,void,ifndef,define,endif,class,constexpr,new,const,auto,double,public,private,protected,signals,slots},
	sensitive=false,
	morecomment=[s][commentstyle]{/*}{*/},
	morecomment=[l][commentstyle]{//},
	morestring=[b][stringstyle]{"},
}

\lstdefinelanguage{JavaScript}{
	keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break},
	ndkeywords={class, export, boolean, throw, implements, import, this},
	sensitive=false,
	morecomment=[l][commentstyle]{//},
	morecomment=[s][commentstyle]{/*}{*/},
	morestring=[b][stringstyle]{'},
	morestring=[b][stringstyle]{"}
}

%% Načtení jazyků.
\lstloadlanguages{[ANSI]C,[LaTeX]TeX,PHP,HTML,Lisp,SQL,TeX,Python,Java,TutorialD,text,csharp,cpp,JavaScript}

% Definice souvisejících prostředí.
\newcommand{\upinlinecode}[3]{
\noindent\ignorespaces\lstinline[style=upbasestyle,language=#1]#2#3#2\ignorespacesafterend
}

\lstnewenvironment{upcode}[3]{
  \lstset{language=#1,float=ht,style=upbasestyle,firstnumber=1,caption={#3},label={#2},aboveskip=10px,belowskip=15px}
}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Loga.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\equal{\upb@blacklogo}{true}}{
  \newcommand{\uplogofile}{graphics/uplogo-black}
}{
  \newcommand{\uplogofile}{graphics/uplogo-white}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Teorémy.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{thmtools}

% Definice základných stylů.
\declaretheoremstyle[
	headfont=\normalfont\bfseries,
	notefont=\normalfont\bfseries,
	bodyfont=\itshape,
	spaceabove=\parskip,
	spacebelow=\parskip,
	headpunct=:
]{upthmstyle}

\declaretheoremstyle[
	notefont=\bfseries,
	spaceabove=\parskip,
	spacebelow=\parskip,
	headpunct=:
]{updefstyle}

\declaretheoremstyle[
	headfont=\normalfont\scshape,
	notefont=\normalfont\scshape,
	spaceabove=\parskip,
	spacebelow=\parskip,
	headpunct=:
]{upremexstyle}

\declaretheoremstyle[
	headfont=\normalfont\scshape,
	notefont=\normalfont\scshape,
	spaceabove=\parskip,
	spacebelow=\parskip,
	qed=\qedsymbol,
	headpunct=:
]{upproofstyle}

% Zakázání starého prostředí pro sazbu důkazů.
\let\proof\@undefined

% Definice prostředí pro sazbu teorémů.
\declaretheorem[within=section,style=updefstyle,numbered=yes,name=\uptextdefinition]{definition}
\declaretheorem[within=section,style=upthmstyle,numbered=yes,name=\uptextlemma]{lemma}
\declaretheorem[within=section,style=upthmstyle,numbered=yes,name=\uptextconsequence]{consequence}
\declaretheorem[within=section,style=upremexstyle,numbered=yes,name=\uptextremark]{remark}
\declaretheorem[within=section,style=upremexstyle,numbered=yes,name=\uptextexample]{example}
\declaretheorem[within=section,style=upthmstyle,numbered=yes,name=\uptexttheorem]{theorem}
\declaretheorem[style=upproofstyle,numbered=no,name=\uptextproof]{proof}

% Záloha a definice seznamu teorémů.
\let\orglistoftheorems=\listoftheorems

\renewcommand{\listoftheorems}{
  \orglistoftheorems[ignoreall,show={definition,consequence,lemma,remark,theorem,proof,example}]
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Hypertextové odkazy.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\equal{\upb@printversion}{true}}{
  \hypersetup{
    colorlinks=false
  }
}{
  \hypersetup{
    colorlinks=true
  }
}

\hypersetup{
  linktocpage=true, pdfstartpage=1, pageanchor=true,
  pdfstartview=FitV, breaklinks=true, pdfpagemode=UseNone, 
  plainpages=false, bookmarksnumbered,
  hypertexnames=true, pdfhighlight=/O,
  urlcolor=darkblue, linkcolor=darkblue, 
  citecolor=darkblue
}

%% Tisk klikacích odkazů.
\let\orghref=\href

\ifthenelse{\equal{\upb@printversion}{true}}{
  \renewcommand{\href}[2]{#2 (\orghref{#1}{#1})}
  \newcommand{\mail}[2]{#2 (\orghref{mailto:#1}{#1})}
}{
	\newcommand{\mail}[2]{\href{mailto:#1}{#2}}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Čítání rovnic na základě sekcí.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\counterwithin{equation}{section}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Sazba seznamů.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\upprintlists}{
  \cleardoublepage
  \ifthenelse{\equal{\upb@figures}{true}}{
    \listoffigures
    \ifthenelse{\equal{\upb@joinlists}{true}}{
      \relax
    }{
      \clearpage
    }
  }{
    \relax
  }
  
  \ifthenelse{\equal{\upb@tables}{true}}{
    \listoftables
    \ifthenelse{\equal{\upb@joinlists}{true}}{
      \relax
    }{
      \clearpage
    }
  }{
    \relax
  }

  \ifthenelse{\equal{\upb@theorems}{true}}{
    \listoftheorems
    \ifthenelse{\equal{\upb@joinlists}{true}}{
      \relax
    }{
      \clearpage
    }
  }{
    \relax
  }

  \ifthenelse{\equal{\upb@sourcecodes}{true}}{
    \lstlistoflistings
    \ifthenelse{\equal{\upb@joinlists}{true}}{
      \relax
    }{
      \clearpage
    }
  }{
    \relax
  }
  \cleardoublepage
}

\endinput