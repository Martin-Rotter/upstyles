\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{updiplom}[2012/09/09 UP Diploma Style]
\PackageWarningNoLine{updiplom}{[updiplom] You are using updiplom style 0.72}

\RequirePackage{kvoptions}

\SetupKeyvalOptions {
	family=upd,
	prefix=upd@
}

% TODO: Nahazet sem parametry a poctivě dělit.
\DeclareBoolOption{master}
\DeclareStringOption[utf8]{encoding}[utf8]
\DeclareStringOption[]{bibfile}[]
\DeclareStringOption[utf8]{bibencoding}[utf8]
\DeclareStringOption[czech]{language}[czech]
\DeclareStringOption[false]{printversion}[false]
\DeclareStringOption[false]{joinlists}[false]
\DeclareStringOption[true]{figures}[true]
\DeclareStringOption[true]{tables}[true]
\DeclareStringOption[true]{sourcecodes}[true]
\DeclareStringOption[true]{glossaries}[true]

%% Nerozpoznaný parametr hodí chybu.
\DeclareDefaultOption{\PackageWarningNoLine{updiplom}{[updiplom] Option '\CurrentOption' was not recognized}}

\ProcessKeyvalOptions*

\RequirePackage[
	joinlists=\upd@joinlists,
	encoding=\upd@encoding,
	bibencoding=\upd@bibencoding,
	language=\upd@language,
	printversion=\upd@printversion,
	joinlists=\upd@joinlists,
	figures=\upd@figures,
	tables=\upd@tables,
	glossaries=\upd@glossaries,
	sourcecodes=\upd@sourcecodes
]{upbase}

\RequirePackage[
	paper=a4paper,
	driver=pdftex,
	top=2.5cm,
	left=3.5cm,
	bottom=2.0cm,
	width=1.15\textwidth
]{geometry}

\ifthenelse{\boolean{@twoside}}{
  \PackageError{updiplom}{Two-sided document mode is not allowed for updiplom}
}{}

%% nastavení textů
%% anaogicky přidat pro ostatní jazyky, aktuálně pouze čeština
\ifthenelse{\equal{\upb@language}{czech}} {
\newcommand{\uptexttitle}{Tituln\'i strana}
\newcommand{\uptexttitletop}{P\v R\'IRODOV\v EDECK\'A FAKULTA UNIVERZITY PALACK\'EHO}
\newcommand{\uptextdept}{KATEDRA INFORMATIKY}
\newcommand{\uptextleader}{Vedoucí práce: }
\newcommand{\uptextdipl}{Diplomant: }
\newcommand{\uptextfinish}{Rok odevzdání: }
\newcommand{\uptextanot}{Anotace}
\newcommand{\uptextthx}{Pod\v ekov\'an\'i}

\ifthenelse{\boolean{upd@master}} {
\def\@upthesis{DIPLOMOV\'A PR\'ACE}
} {
\def\@upthesis{BAKAL\'A\v RSK\'A PR\'ACE}
}
} {
\relax
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% conclusions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newenvironment{upconclusions}[1][czech]{
\cleardoublepage
\bgroup
\ifthenelse{\equal{#1}{czech}} {
\phantomsection
\addcontentsline{toc}{section}{Z\'av\v er}
\section*{Z\'av\v er}
}
%% else branch stands for english conclusions
{
\phantomsection
\addcontentsline{toc}{section}{Conclusions}
\section*{Conclusions}
}
\begin{otherlanguage}{#1}
} {
\end{otherlanguage}
\egroup
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% titlepage implementation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\upthanks#1{\gdef\@upthanks{#1}}
\def\annotation#1{\gdef\@annotation{#1}}

%% hacking wrong page numbering
\let\oldsetcounter=\setcounter
\renewcommand\setcounter[2]{%
  \def\tempa{#1}%
  \def\tempb{page}%
  \ifx\tempa\tempb\else\oldsetcounter{#1}{#2}\fi}

\def\uptitle#1{\gdef\@uptitle{#1}}
\def\upsubtitle#1{\gdef\@upsubtitle{#1}}
\def\upyear#1{\gdef\@upyear{#1}}
\def\upauthor#1{\gdef\@upauthor{#1}}
\def\upleader#1{\gdef\@upleader{#1}}
\def\upclass#1{\gdef\@upclass{#1}}

% podnadpis
\upsubtitle{\null}

\def\maketitle{
\hypertarget{up:thesis}{}
\bookmark[dest=up:thesis]{\@uptitle}
\setcounter{page}{1}
\begin{titlepage}
\hypertarget{up:title}{}
\bookmark[
 rellevel=1,
 keeplevel,
 dest=up:title
]{\uptexttitle}
\begin{center}
{\large \uptexttitletop \par
        \uptextdept \par}
\vfill
{\LARGE\bfseries{\@upthesis} \\}
\vfill
{\Large \@uptitle \\[1em]\@upsubtitle}

\vfill
\centering
\includegraphics[width=2.5cm]{\uplogofile}
\vfill
{\noindent
\begin{tabular}{ll}
\uptextleader\\
{\bfseries\@upleader} \\
\uptextfinish\@upyear
\end{tabular}
\hfill
\begin{tabular}{ll}
\uptextdipl\\
{\bfseries\@upauthor} \\
\@upclass
\end{tabular}}
\end{center}
\end{titlepage}

% tiskne dvě strany s anotací a poděkováním
\cleardoublepage
\thispagestyle{empty}
\null\vfill
\hypertarget{up:anotation}{}
\bookmark[
 rellevel=1,
 keeplevel,
 dest=up:anotation
]{\uptextanot}
\begin{center}
\textbf{\uptextanot}
\end{center}
\bigskip
\emph{\@annotation}
\vfill\null
\cleardoublepage
\thispagestyle{empty}
\vspace*{\fill}
\hypertarget{up:thx}{}
\bookmark[
 rellevel=1,
 keeplevel,
 dest=up:thx
]{\uptextthx}
\noindent\@upthanks

% tiskne obsah a seznamy obrázku, tabulek a případně zdr. kódů, více v makrech \uptableofcontents a \upprintlists
\uptableofcontents
\ifthenelse{\equal{\upb@joinlists}{true}} {
\relax
} {
\cleardoublepage
}
\upprintlists
}

\newcommand{\upmakeendlists}{
% tiskne seznam zkratek
\printglossary

% tiskne seznam teorémů
\listoftheorems
}