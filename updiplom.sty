\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{updiplom}[2012/09/09 UP Diploma Style]
\PackageWarningNoLine{updiplom}{[updiplom] You are using updiplom style 0.7}

\RequirePackage{kvoptions}

\SetupKeyvalOptions {
	family=upd,
	prefix=upd@
}

% TODO: Nahazet sem parametry a poctivě dělit.
\DeclareBoolOption{master}
\DeclareStringOption[utf8]{encoding}[utf8]
\DeclareStringOption[]{bibfile}[]
\DeclareStringOption[utf8]{bibencoding}[utf8]
\DeclareStringOption[czech]{language}[czech]
\DeclareStringOption[false]{printversion}[false]
\DeclareStringOption[false]{joinlists}[false]
\DeclareStringOption[true]{figures}[true]
\DeclareStringOption[true]{tables}[true]
\DeclareStringOption[true]{sourcecodes}[true]
\DeclareStringOption[true]{glossaries}[true]

%% Nerozpoznaný parametr hodí chybu.
\DeclareDefaultOption{\PackageWarningNoLine{upbase}{[updiplom] Option '\CurrentOption' was not recognized}}

\ProcessKeyvalOptions*

\RequirePackage[
	joinlists=\upd@joinlists,
	encoding=\upd@encoding,
	bibencoding=\upd@bibencoding,
	bibfile=\upd@bibfile,
	language=\upd@language,
	printversion=\upd@printversion,
	joinlists=\upd@joinlists,
	figures=\upd@figures,
	tables=\upd@tables,
	glossaries=\upd@glossaries,
	sourcecodes=\upd@sourcecodes
]{upbase}

\RequirePackage[
	paper=a4paper,
	driver=pdftex,
	top=3.0cm,
	left=4.0cm,
	bottom=2.5cm,
	width=1.05\textwidth
]{geometry}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% conclusions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newenvironment{upconclusions}[1][czech]{
\clearpage
\bgroup
\ifthenelse{\equal{#1}{czech}} {
\phantomsection
\addcontentsline{toc}{section}{Z\'av\v er}
\section*{Z\'av\v er}
}
%% else branch stands for english conclusions
{
\phantomsection
\addcontentsline{toc}{section}{Conclusions}
\section*{Conclusions}
}
\begin{otherlanguage}{#1}
} {
\end{otherlanguage}
\egroup
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% titlepage heading
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifthenelse{\boolean{upd@master}} {
\def\@upthesis{DIPLOMOV\'A PR\'ACE}
} {
\def\@upthesis{BAKAL\'A\v RSK\'A PR\'ACE}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% titlepage implementation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% hacking wrong page numbering
\let\oldsetcounter=\setcounter
\renewcommand\setcounter[2]{%
  \def\tempa{#1}%
  \def\tempb{page}%
  \ifx\tempa\tempb\else\oldsetcounter{#1}{#2}\fi}

\def\uptitle#1{\gdef\@uptitle{#1}}
\def\upsubtitle#1{\gdef\@upsubtitle{#1}}
\def\upyear#1{\gdef\@upyear{#1}}
\def\upauthor#1{\gdef\@upauthor{#1}}
\def\upleader#1{\gdef\@upleader{#1}}
\def\upclass#1{\gdef\@upclass{#1}}

\def\maketitle{
\hypertarget{up:thesis}{}
\bookmark[dest=up:thesis]{\@uptitle}
\setcounter{page}{1}
\begin{titlepage}
\hypertarget{up:title}{}
\bookmark[
 rellevel=1,
 keeplevel,
 dest=up:title
]{Tituln\'i strana}
\begin{center}
{\large P\v R\'IRODOV\v EDECK\'A FAKULTA UNIVERZITY PALACK\'EHO \par
        KATEDRA INFORMATIKY \par}
\vfill
{\LARGE\bfseries{\@upthesis} \\}
\vfill
{\Large \@uptitle \\[1em]\@upsubtitle}

\vspace{3em}
\centering
\includegraphics[width=2.5cm]{\uplogoname}
\vfill
{\noindent
\begin{tabular}{ll}
Vedoucí práce: \\
{\bfseries\@upleader} \\
Rok odevzdání: \@upyear
\end{tabular}
\hfill
\begin{tabular}{ll}
Diplomant: \\
{\bfseries\@upauthor} \\
\@upclass
\end{tabular}}
\end{center}
\clearpage
\end{titlepage}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% anot+thanks implementation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\upthanks#1{\gdef\@upthanks{#1}}
\def\upanot#1{\gdef\@upanot{#1}}

\def\upthanksanot{
\thispagestyle{empty}
\null\vfill
\hypertarget{up:anotation}{}
\bookmark[
 rellevel=1,
 keeplevel,
 dest=up:anotation
]{Anotace}
\begin{center}
\textbf{Anotace}
\end{center}
\emph{\@upanot}
\vfill\null
\clearpage
\thispagestyle{empty}
\vspace*{\fill}
\hypertarget{up:thx}{}
\bookmark[
 rellevel=1,
 keeplevel,
 dest=up:thx
]{Pod\v ekov\'an\'i}
\noindent\@upthanks
\clearpage
}